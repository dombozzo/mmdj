/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/// <reference types="youtube"/>
/// <reference types="youtube"/>
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { YTPlayerService } from './ytplayer.service';
import { parseQueryString } from './util';
export class YTPlayerComponent {
    /**
     * @param {?} ytPlayerService
     */
    constructor(ytPlayerService) {
        this.ytPlayerService = ytPlayerService;
        this.ready = new EventEmitter();
        this.unstarted = new EventEmitter();
        this.ended = new EventEmitter();
        this.playing = new EventEmitter();
        this.paused = new EventEmitter();
        this.buffering = new EventEmitter();
        this.cued = new EventEmitter();
    }
    /**
     * @return {?}
     */
    get currentTime() {
        return this.player.getCurrentTime();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.ytPlayerService.addPlayer(this);
        this.domId = this.domId || this.videoId || 'ng-yt-player-' + this.ytPlayerService.playersCount;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.ytPlayerService.apiReady.subscribe((/**
         * @param {?} ready
         * @return {?}
         */
        ready => {
            if (ready && !this.player) {
                /** @type {?} */
                const parameters = typeof this.parameters === 'string' ? parseQueryString(this.parameters) : this.parameters;
                this.player = this.initPlayer(this.videoId, parameters, this.domId);
            }
        }));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.ytPlayerService.removePlayer(this);
    }
    /**
     * @return {?}
     */
    play() {
        if (this.isReady) {
            this.player.playVideo();
        }
        else {
            console.warn('The player was not ready when tried to play.');
        }
    }
    /**
     * @return {?}
     */
    pause() {
        if (this.isReady) {
            this.player.pauseVideo();
        }
        else {
            console.warn('The player was not ready when tried to pause.');
        }
    }
    /**
     * @param {?} videoId
     * @param {?=} startSeconds
     * @return {?}
     */
    cueVideoById(videoId, startSeconds) {
        if (this.isReady) {
            this.player.cueVideoById(videoId, startSeconds);
        }
        else {
            console.warn('The player was not ready when tried to cueVideoById.');
        }
    }
    /**
     * @param {?} videoId
     * @param {?=} startSeconds
     * @return {?}
     */
    loadVideoById(videoId, startSeconds) {
        if (this.isReady) {
            this.player.loadVideoById(videoId, startSeconds);
        }
        else {
            console.warn('The player was not ready when tried to loadVideoById.');
        }
    }
    /**
     * @private
     * @return {?}
     */
    onplay() {
        this.playing.emit();
        this.ytPlayerService.pauseAllExcept(this);
    }
    /**
     * @private
     * @param {?} videoId
     * @param {?} playerVars
     * @param {?} domId
     * @return {?}
     */
    initPlayer(videoId, playerVars, domId) {
        /** @type {?} */
        const onReady = (/**
         * @return {?}
         */
        () => {
            if (!this.isReady) {
                this.ready.emit();
                this.isReady = true;
            }
        });
        /** @type {?} */
        const onStateChange = (/**
         * @param {?} __0
         * @return {?}
         */
        ({ data }) => {
            switch (data) {
                case -1 /* UNSTARTED */:
                    this.unstarted.emit();
                    break;
                case 0 /* ENDED */:
                    this.ended.emit();
                    break;
                case 1 /* PLAYING */:
                    this.onplay();
                    break;
                case 2 /* PAUSED */:
                    this.paused.emit();
                    break;
                case 3 /* BUFFERING */:
                    this.buffering.emit();
                    break;
                case 5 /* CUED */:
                    this.cued.emit();
                    break;
            }
        });
        return new YT.Player(domId, {
            videoId,
            playerVars,
            events: { onReady, onStateChange }
        });
    }
}
YTPlayerComponent.decorators = [
    { type: Component, args: [{
                selector: 'lib-ytplayer',
                template: '<div [id]="domId"></div>',
                styles: [':host, :host ::ng-deep iframe { display: block; width: 100%; height: 100%; }']
            }] }
];
/** @nocollapse */
YTPlayerComponent.ctorParameters = () => [
    { type: YTPlayerService }
];
YTPlayerComponent.propDecorators = {
    videoId: [{ type: Input }],
    domId: [{ type: Input }],
    parameters: [{ type: Input }],
    ready: [{ type: Output }],
    unstarted: [{ type: Output }],
    ended: [{ type: Output }],
    playing: [{ type: Output }],
    paused: [{ type: Output }],
    buffering: [{ type: Output }],
    cued: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    YTPlayerComponent.prototype.videoId;
    /** @type {?} */
    YTPlayerComponent.prototype.domId;
    /** @type {?} */
    YTPlayerComponent.prototype.parameters;
    /** @type {?} */
    YTPlayerComponent.prototype.ready;
    /** @type {?} */
    YTPlayerComponent.prototype.unstarted;
    /** @type {?} */
    YTPlayerComponent.prototype.ended;
    /** @type {?} */
    YTPlayerComponent.prototype.playing;
    /** @type {?} */
    YTPlayerComponent.prototype.paused;
    /** @type {?} */
    YTPlayerComponent.prototype.buffering;
    /** @type {?} */
    YTPlayerComponent.prototype.cued;
    /**
     * @type {?}
     * @private
     */
    YTPlayerComponent.prototype.player;
    /**
     * @type {?}
     * @private
     */
    YTPlayerComponent.prototype.isReady;
    /**
     * @type {?}
     * @private
     */
    YTPlayerComponent.prototype.ytPlayerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieXRwbGF5ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci15b3V0dWJlLXBsYXllci8iLCJzb3VyY2VzIjpbImxpYi95dHBsYXllci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLGdDQUFnQzs7QUFFaEMsT0FBTyxFQUFFLFNBQVMsRUFBb0MsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQU8xQyxNQUFNLE9BQU8saUJBQWlCOzs7O0lBb0I1QixZQUFvQixlQUFnQztRQUFoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFmMUMsVUFBSyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDM0IsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDL0IsVUFBSyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDM0IsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDN0IsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDNUIsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7UUFDL0IsU0FBSSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFTbUIsQ0FBQzs7OztJQVB4RCxJQUFXLFdBQVc7UUFDcEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3RDLENBQUM7Ozs7SUFPRCxRQUFRO1FBQ04sSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDO0lBQ2pHLENBQUM7Ozs7SUFFRCxlQUFlO1FBQ2IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsU0FBUzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzlDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTs7c0JBQ25CLFVBQVUsR0FBa0IsT0FBTyxJQUFJLENBQUMsVUFBVSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVTtnQkFDM0gsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUNyRTtRQUNILENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7OztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxQyxDQUFDOzs7O0lBRU0sSUFBSTtRQUNULElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3pCO2FBQU07WUFDTCxPQUFPLENBQUMsSUFBSSxDQUFDLDhDQUE4QyxDQUFDLENBQUM7U0FDOUQ7SUFDSCxDQUFDOzs7O0lBRU0sS0FBSztRQUNWLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQzFCO2FBQU07WUFDTCxPQUFPLENBQUMsSUFBSSxDQUFDLCtDQUErQyxDQUFDLENBQUM7U0FDL0Q7SUFDSCxDQUFDOzs7Ozs7SUFFTSxZQUFZLENBQUMsT0FBZSxFQUFFLFlBQXFCO1FBQ3hELElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDakQ7YUFBTTtZQUNMLE9BQU8sQ0FBQyxJQUFJLENBQUMsc0RBQXNELENBQUMsQ0FBQztTQUN0RTtJQUNILENBQUM7Ozs7OztJQUVNLGFBQWEsQ0FBQyxPQUFlLEVBQUUsWUFBcUI7UUFDekQsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQztTQUNsRDthQUFNO1lBQ0wsT0FBTyxDQUFDLElBQUksQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO1NBQ3ZFO0lBQ0gsQ0FBQzs7Ozs7SUFFTyxNQUFNO1FBQ1osSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QyxDQUFDOzs7Ozs7OztJQUVPLFVBQVUsQ0FBQyxPQUFlLEVBQUUsVUFBeUIsRUFBRSxLQUFhOztjQUNwRSxPQUFPOzs7UUFBRyxHQUFHLEVBQUU7WUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBQ2pCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO2FBQ3JCO1FBQ0gsQ0FBQyxDQUFBOztjQUNLLGFBQWE7Ozs7UUFBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRTtZQUNqQyxRQUFRLElBQUksRUFBRTtnQkFDWjtvQkFDRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO29CQUN0QixNQUFNO2dCQUNSO29CQUNFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQ2xCLE1BQU07Z0JBQ1I7b0JBQ0UsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO29CQUNkLE1BQU07Z0JBQ1I7b0JBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDbkIsTUFBTTtnQkFDUjtvQkFDRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO29CQUN0QixNQUFNO2dCQUNSO29CQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQ2pCLE1BQU07YUFDVDtRQUNILENBQUMsQ0FBQTtRQUVELE9BQU8sSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRTtZQUMxQixPQUFPO1lBQ1AsVUFBVTtZQUNWLE1BQU0sRUFBRSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUU7U0FDbkMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7O1lBckhGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsY0FBYztnQkFDeEIsUUFBUSxFQUFFLDBCQUEwQjt5QkFDM0IsOEVBQThFO2FBQ3hGOzs7O1lBUFEsZUFBZTs7O3NCQVNyQixLQUFLO29CQUNMLEtBQUs7eUJBQ0wsS0FBSztvQkFFTCxNQUFNO3dCQUNOLE1BQU07b0JBQ04sTUFBTTtzQkFDTixNQUFNO3FCQUNOLE1BQU07d0JBQ04sTUFBTTttQkFDTixNQUFNOzs7O0lBVlAsb0NBQXlCOztJQUN6QixrQ0FBdUI7O0lBQ3ZCLHVDQUE0Qzs7SUFFNUMsa0NBQXFDOztJQUNyQyxzQ0FBeUM7O0lBQ3pDLGtDQUFxQzs7SUFDckMsb0NBQXVDOztJQUN2QyxtQ0FBc0M7O0lBQ3RDLHNDQUF5Qzs7SUFDekMsaUNBQW9DOzs7OztJQU1wQyxtQ0FBMEI7Ozs7O0lBQzFCLG9DQUF5Qjs7Ozs7SUFFYiw0Q0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSB0eXBlcz1cInlvdXR1YmVcIi8+XG5cbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3ksIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBZVFBsYXllclNlcnZpY2UgfSBmcm9tICcuL3l0cGxheWVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgcGFyc2VRdWVyeVN0cmluZyB9IGZyb20gJy4vdXRpbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2xpYi15dHBsYXllcicsXG4gIHRlbXBsYXRlOiAnPGRpdiBbaWRdPVwiZG9tSWRcIj48L2Rpdj4nLFxuICBzdHlsZXM6IFsnOmhvc3QsIDpob3N0IDo6bmctZGVlcCBpZnJhbWUgeyBkaXNwbGF5OiBibG9jazsgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgfSddXG59KVxuZXhwb3J0IGNsYXNzIFlUUGxheWVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSB2aWRlb0lkOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGRvbUlkOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHBhcmFtZXRlcnM6IHN0cmluZyB8IFlULlBsYXllclZhcnM7XG5cbiAgQE91dHB1dCgpIHJlYWR5ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgdW5zdGFydGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgZW5kZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBwbGF5aW5nID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcGF1c2VkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgYnVmZmVyaW5nID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgY3VlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICBwdWJsaWMgZ2V0IGN1cnJlbnRUaW1lKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucGxheWVyLmdldEN1cnJlbnRUaW1lKCk7XG4gIH1cblxuICBwcml2YXRlIHBsYXllcjogWVQuUGxheWVyO1xuICBwcml2YXRlIGlzUmVhZHk6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSB5dFBsYXllclNlcnZpY2U6IFlUUGxheWVyU2VydmljZSkge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnl0UGxheWVyU2VydmljZS5hZGRQbGF5ZXIodGhpcyk7XG4gICAgdGhpcy5kb21JZCA9IHRoaXMuZG9tSWQgfHwgdGhpcy52aWRlb0lkIHx8ICduZy15dC1wbGF5ZXItJyArIHRoaXMueXRQbGF5ZXJTZXJ2aWNlLnBsYXllcnNDb3VudDtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLnl0UGxheWVyU2VydmljZS5hcGlSZWFkeS5zdWJzY3JpYmUocmVhZHkgPT4ge1xuICAgICAgaWYgKHJlYWR5ICYmICF0aGlzLnBsYXllcikge1xuICAgICAgICBjb25zdCBwYXJhbWV0ZXJzOiBZVC5QbGF5ZXJWYXJzID0gdHlwZW9mIHRoaXMucGFyYW1ldGVycyA9PT0gJ3N0cmluZycgPyBwYXJzZVF1ZXJ5U3RyaW5nKHRoaXMucGFyYW1ldGVycykgOiB0aGlzLnBhcmFtZXRlcnM7XG4gICAgICAgIHRoaXMucGxheWVyID0gdGhpcy5pbml0UGxheWVyKHRoaXMudmlkZW9JZCwgcGFyYW1ldGVycywgdGhpcy5kb21JZCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnl0UGxheWVyU2VydmljZS5yZW1vdmVQbGF5ZXIodGhpcyk7XG4gIH1cblxuICBwdWJsaWMgcGxheSgpIHtcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XG4gICAgICB0aGlzLnBsYXllci5wbGF5VmlkZW8oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdUaGUgcGxheWVyIHdhcyBub3QgcmVhZHkgd2hlbiB0cmllZCB0byBwbGF5LicpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBwYXVzZSgpIHtcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XG4gICAgICB0aGlzLnBsYXllci5wYXVzZVZpZGVvKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybignVGhlIHBsYXllciB3YXMgbm90IHJlYWR5IHdoZW4gdHJpZWQgdG8gcGF1c2UuJyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGN1ZVZpZGVvQnlJZCh2aWRlb0lkOiBzdHJpbmcsIHN0YXJ0U2Vjb25kcz86IG51bWJlcikge1xuICAgIGlmICh0aGlzLmlzUmVhZHkpIHtcbiAgICAgIHRoaXMucGxheWVyLmN1ZVZpZGVvQnlJZCh2aWRlb0lkLCBzdGFydFNlY29uZHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1RoZSBwbGF5ZXIgd2FzIG5vdCByZWFkeSB3aGVuIHRyaWVkIHRvIGN1ZVZpZGVvQnlJZC4nKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbG9hZFZpZGVvQnlJZCh2aWRlb0lkOiBzdHJpbmcsIHN0YXJ0U2Vjb25kcz86IG51bWJlcikge1xuICAgIGlmICh0aGlzLmlzUmVhZHkpIHtcbiAgICAgIHRoaXMucGxheWVyLmxvYWRWaWRlb0J5SWQodmlkZW9JZCwgc3RhcnRTZWNvbmRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdUaGUgcGxheWVyIHdhcyBub3QgcmVhZHkgd2hlbiB0cmllZCB0byBsb2FkVmlkZW9CeUlkLicpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb25wbGF5KCkge1xuICAgIHRoaXMucGxheWluZy5lbWl0KCk7XG4gICAgdGhpcy55dFBsYXllclNlcnZpY2UucGF1c2VBbGxFeGNlcHQodGhpcyk7XG4gIH1cblxuICBwcml2YXRlIGluaXRQbGF5ZXIodmlkZW9JZDogc3RyaW5nLCBwbGF5ZXJWYXJzOiBZVC5QbGF5ZXJWYXJzLCBkb21JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qgb25SZWFkeSA9ICgpID0+IHtcbiAgICAgIGlmICghdGhpcy5pc1JlYWR5KSB7XG4gICAgICAgIHRoaXMucmVhZHkuZW1pdCgpO1xuICAgICAgICB0aGlzLmlzUmVhZHkgPSB0cnVlO1xuICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgb25TdGF0ZUNoYW5nZSA9ICh7IGRhdGEgfSkgPT4ge1xuICAgICAgc3dpdGNoIChkYXRhKSB7XG4gICAgICAgIGNhc2UgWVQuUGxheWVyU3RhdGUuVU5TVEFSVEVEOlxuICAgICAgICAgIHRoaXMudW5zdGFydGVkLmVtaXQoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBZVC5QbGF5ZXJTdGF0ZS5FTkRFRDpcbiAgICAgICAgICB0aGlzLmVuZGVkLmVtaXQoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBZVC5QbGF5ZXJTdGF0ZS5QTEFZSU5HOlxuICAgICAgICAgIHRoaXMub25wbGF5KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgWVQuUGxheWVyU3RhdGUuUEFVU0VEOlxuICAgICAgICAgIHRoaXMucGF1c2VkLmVtaXQoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBZVC5QbGF5ZXJTdGF0ZS5CVUZGRVJJTkc6XG4gICAgICAgICAgdGhpcy5idWZmZXJpbmcuZW1pdCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFlULlBsYXllclN0YXRlLkNVRUQ6XG4gICAgICAgICAgdGhpcy5jdWVkLmVtaXQoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIG5ldyBZVC5QbGF5ZXIoZG9tSWQsIHtcbiAgICAgIHZpZGVvSWQsXG4gICAgICBwbGF5ZXJWYXJzLFxuICAgICAgZXZlbnRzOiB7IG9uUmVhZHksIG9uU3RhdGVDaGFuZ2UgfVxuICAgIH0pO1xuICB9XG59XG4iXX0=