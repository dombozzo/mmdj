/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/// <reference types="youtube"/>
/// <reference types="youtube"/>
import { Component, Input, Output, EventEmitter } from '@angular/core';
import { YTPlayerService } from './ytplayer.service';
import { parseQueryString } from './util';
var YTPlayerComponent = /** @class */ (function () {
    function YTPlayerComponent(ytPlayerService) {
        this.ytPlayerService = ytPlayerService;
        this.ready = new EventEmitter();
        this.unstarted = new EventEmitter();
        this.ended = new EventEmitter();
        this.playing = new EventEmitter();
        this.paused = new EventEmitter();
        this.buffering = new EventEmitter();
        this.cued = new EventEmitter();
    }
    Object.defineProperty(YTPlayerComponent.prototype, "currentTime", {
        get: /**
         * @return {?}
         */
        function () {
            return this.player.getCurrentTime();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    YTPlayerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.ytPlayerService.addPlayer(this);
        this.domId = this.domId || this.videoId || 'ng-yt-player-' + this.ytPlayerService.playersCount;
    };
    /**
     * @return {?}
     */
    YTPlayerComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.ytPlayerService.apiReady.subscribe((/**
         * @param {?} ready
         * @return {?}
         */
        function (ready) {
            if (ready && !_this.player) {
                /** @type {?} */
                var parameters = typeof _this.parameters === 'string' ? parseQueryString(_this.parameters) : _this.parameters;
                _this.player = _this.initPlayer(_this.videoId, parameters, _this.domId);
            }
        }));
    };
    /**
     * @return {?}
     */
    YTPlayerComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.ytPlayerService.removePlayer(this);
    };
    /**
     * @return {?}
     */
    YTPlayerComponent.prototype.play = /**
     * @return {?}
     */
    function () {
        if (this.isReady) {
            this.player.playVideo();
        }
        else {
            console.warn('The player was not ready when tried to play.');
        }
    };
    /**
     * @return {?}
     */
    YTPlayerComponent.prototype.pause = /**
     * @return {?}
     */
    function () {
        if (this.isReady) {
            this.player.pauseVideo();
        }
        else {
            console.warn('The player was not ready when tried to pause.');
        }
    };
    /**
     * @param {?} videoId
     * @param {?=} startSeconds
     * @return {?}
     */
    YTPlayerComponent.prototype.cueVideoById = /**
     * @param {?} videoId
     * @param {?=} startSeconds
     * @return {?}
     */
    function (videoId, startSeconds) {
        if (this.isReady) {
            this.player.cueVideoById(videoId, startSeconds);
        }
        else {
            console.warn('The player was not ready when tried to cueVideoById.');
        }
    };
    /**
     * @param {?} videoId
     * @param {?=} startSeconds
     * @return {?}
     */
    YTPlayerComponent.prototype.loadVideoById = /**
     * @param {?} videoId
     * @param {?=} startSeconds
     * @return {?}
     */
    function (videoId, startSeconds) {
        if (this.isReady) {
            this.player.loadVideoById(videoId, startSeconds);
        }
        else {
            console.warn('The player was not ready when tried to loadVideoById.');
        }
    };
    /**
     * @private
     * @return {?}
     */
    YTPlayerComponent.prototype.onplay = /**
     * @private
     * @return {?}
     */
    function () {
        this.playing.emit();
        this.ytPlayerService.pauseAllExcept(this);
    };
    /**
     * @private
     * @param {?} videoId
     * @param {?} playerVars
     * @param {?} domId
     * @return {?}
     */
    YTPlayerComponent.prototype.initPlayer = /**
     * @private
     * @param {?} videoId
     * @param {?} playerVars
     * @param {?} domId
     * @return {?}
     */
    function (videoId, playerVars, domId) {
        var _this = this;
        /** @type {?} */
        var onReady = (/**
         * @return {?}
         */
        function () {
            if (!_this.isReady) {
                _this.ready.emit();
                _this.isReady = true;
            }
        });
        /** @type {?} */
        var onStateChange = (/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var data = _a.data;
            switch (data) {
                case -1 /* UNSTARTED */:
                    _this.unstarted.emit();
                    break;
                case 0 /* ENDED */:
                    _this.ended.emit();
                    break;
                case 1 /* PLAYING */:
                    _this.onplay();
                    break;
                case 2 /* PAUSED */:
                    _this.paused.emit();
                    break;
                case 3 /* BUFFERING */:
                    _this.buffering.emit();
                    break;
                case 5 /* CUED */:
                    _this.cued.emit();
                    break;
            }
        });
        return new YT.Player(domId, {
            videoId: videoId,
            playerVars: playerVars,
            events: { onReady: onReady, onStateChange: onStateChange }
        });
    };
    YTPlayerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'lib-ytplayer',
                    template: '<div [id]="domId"></div>',
                    styles: [':host, :host ::ng-deep iframe { display: block; width: 100%; height: 100%; }']
                }] }
    ];
    /** @nocollapse */
    YTPlayerComponent.ctorParameters = function () { return [
        { type: YTPlayerService }
    ]; };
    YTPlayerComponent.propDecorators = {
        videoId: [{ type: Input }],
        domId: [{ type: Input }],
        parameters: [{ type: Input }],
        ready: [{ type: Output }],
        unstarted: [{ type: Output }],
        ended: [{ type: Output }],
        playing: [{ type: Output }],
        paused: [{ type: Output }],
        buffering: [{ type: Output }],
        cued: [{ type: Output }]
    };
    return YTPlayerComponent;
}());
export { YTPlayerComponent };
if (false) {
    /** @type {?} */
    YTPlayerComponent.prototype.videoId;
    /** @type {?} */
    YTPlayerComponent.prototype.domId;
    /** @type {?} */
    YTPlayerComponent.prototype.parameters;
    /** @type {?} */
    YTPlayerComponent.prototype.ready;
    /** @type {?} */
    YTPlayerComponent.prototype.unstarted;
    /** @type {?} */
    YTPlayerComponent.prototype.ended;
    /** @type {?} */
    YTPlayerComponent.prototype.playing;
    /** @type {?} */
    YTPlayerComponent.prototype.paused;
    /** @type {?} */
    YTPlayerComponent.prototype.buffering;
    /** @type {?} */
    YTPlayerComponent.prototype.cued;
    /**
     * @type {?}
     * @private
     */
    YTPlayerComponent.prototype.player;
    /**
     * @type {?}
     * @private
     */
    YTPlayerComponent.prototype.isReady;
    /**
     * @type {?}
     * @private
     */
    YTPlayerComponent.prototype.ytPlayerService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieXRwbGF5ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci15b3V0dWJlLXBsYXllci8iLCJzb3VyY2VzIjpbImxpYi95dHBsYXllci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLGdDQUFnQzs7QUFFaEMsT0FBTyxFQUFFLFNBQVMsRUFBb0MsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3JELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUUxQztJQXlCRSwyQkFBb0IsZUFBZ0M7UUFBaEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBZjFDLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzNCLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQy9CLFVBQUssR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzNCLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzdCLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQzVCLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO1FBQy9CLFNBQUksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBU21CLENBQUM7SUFQeEQsc0JBQVcsMENBQVc7Ozs7UUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEMsQ0FBQzs7O09BQUE7Ozs7SUFPRCxvQ0FBUTs7O0lBQVI7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxZ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TSxFQUFFLENBQUM7b0JBQ2QsTUFBTTtnQkFDUjtvQkFDRSxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO29CQUNuQixNQUFNO2dCQUNSO29CQUNFLEtBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQ3RCLE1BQU07Z0JBQ1I7b0JBQ0UsS0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDakIsTUFBTTthQUNUO1FBQ0gsQ0FBQyxDQUFBO1FBRUQsT0FBTyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFO1lBQzFCLE9BQU8sU0FBQTtZQUNQLFVBQVUsWUFBQTtZQUNWLE1BQU0sRUFBRSxFQUFFLE9BQU8sU0FBQSxFQUFFLGFBQWEsZUFBQSxFQUFFO1NBQ25DLENBQUMsQ0FBQztJQUNMLENBQUM7O2dCQXJIRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGNBQWM7b0JBQ3hCLFFBQVEsRUFBRSwwQkFBMEI7NkJBQzNCLDhFQUE4RTtpQkFDeEY7Ozs7Z0JBUFEsZUFBZTs7OzBCQVNyQixLQUFLO3dCQUNMLEtBQUs7NkJBQ0wsS0FBSzt3QkFFTCxNQUFNOzRCQUNOLE1BQU07d0JBQ04sTUFBTTswQkFDTixNQUFNO3lCQUNOLE1BQU07NEJBQ04sTUFBTTt1QkFDTixNQUFNOztJQXNHVCx3QkFBQztDQUFBLEFBdEhELElBc0hDO1NBakhZLGlCQUFpQjs7O0lBQzVCLG9DQUF5Qjs7SUFDekIsa0NBQXVCOztJQUN2Qix1Q0FBNEM7O0lBRTVDLGtDQUFxQzs7SUFDckMsc0NBQXlDOztJQUN6QyxrQ0FBcUM7O0lBQ3JDLG9DQUF1Qzs7SUFDdkMsbUNBQXNDOztJQUN0QyxzQ0FBeUM7O0lBQ3pDLGlDQUFvQzs7Ozs7SUFNcEMsbUNBQTBCOzs7OztJQUMxQixvQ0FBeUI7Ozs7O0lBRWIsNENBQXdDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgdHlwZXM9XCJ5b3V0dWJlXCIvPlxuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgWVRQbGF5ZXJTZXJ2aWNlIH0gZnJvbSAnLi95dHBsYXllci5zZXJ2aWNlJztcbmltcG9ydCB7IHBhcnNlUXVlcnlTdHJpbmcgfSBmcm9tICcuL3V0aWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWIteXRwbGF5ZXInLFxuICB0ZW1wbGF0ZTogJzxkaXYgW2lkXT1cImRvbUlkXCI+PC9kaXY+JyxcbiAgc3R5bGVzOiBbJzpob3N0LCA6aG9zdCA6Om5nLWRlZXAgaWZyYW1lIHsgZGlzcGxheTogYmxvY2s7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IH0nXVxufSlcbmV4cG9ydCBjbGFzcyBZVFBsYXllckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgdmlkZW9JZDogc3RyaW5nO1xuICBASW5wdXQoKSBkb21JZDogc3RyaW5nO1xuICBASW5wdXQoKSBwYXJhbWV0ZXJzOiBzdHJpbmcgfCBZVC5QbGF5ZXJWYXJzO1xuXG4gIEBPdXRwdXQoKSByZWFkeSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHVuc3RhcnRlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGVuZGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgcGxheWluZyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIHBhdXNlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGJ1ZmZlcmluZyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgQE91dHB1dCgpIGN1ZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgcHVibGljIGdldCBjdXJyZW50VGltZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnBsYXllci5nZXRDdXJyZW50VGltZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBwbGF5ZXI6IFlULlBsYXllcjtcbiAgcHJpdmF0ZSBpc1JlYWR5OiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgeXRQbGF5ZXJTZXJ2aWNlOiBZVFBsYXllclNlcnZpY2UpIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy55dFBsYXllclNlcnZpY2UuYWRkUGxheWVyKHRoaXMpO1xuICAgIHRoaXMuZG9tSWQgPSB0aGlzLmRvbUlkIHx8IHRoaXMudmlkZW9JZCB8fCAnbmcteXQtcGxheWVyLScgKyB0aGlzLnl0UGxheWVyU2VydmljZS5wbGF5ZXJzQ291bnQ7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy55dFBsYXllclNlcnZpY2UuYXBpUmVhZHkuc3Vic2NyaWJlKHJlYWR5ID0+IHtcbiAgICAgIGlmIChyZWFkeSAmJiAhdGhpcy5wbGF5ZXIpIHtcbiAgICAgICAgY29uc3QgcGFyYW1ldGVyczogWVQuUGxheWVyVmFycyA9IHR5cGVvZiB0aGlzLnBhcmFtZXRlcnMgPT09ICdzdHJpbmcnID8gcGFyc2VRdWVyeVN0cmluZyh0aGlzLnBhcmFtZXRlcnMpIDogdGhpcy5wYXJhbWV0ZXJzO1xuICAgICAgICB0aGlzLnBsYXllciA9IHRoaXMuaW5pdFBsYXllcih0aGlzLnZpZGVvSWQsIHBhcmFtZXRlcnMsIHRoaXMuZG9tSWQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy55dFBsYXllclNlcnZpY2UucmVtb3ZlUGxheWVyKHRoaXMpO1xuICB9XG5cbiAgcHVibGljIHBsYXkoKSB7XG4gICAgaWYgKHRoaXMuaXNSZWFkeSkge1xuICAgICAgdGhpcy5wbGF5ZXIucGxheVZpZGVvKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybignVGhlIHBsYXllciB3YXMgbm90IHJlYWR5IHdoZW4gdHJpZWQgdG8gcGxheS4nKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgcGF1c2UoKSB7XG4gICAgaWYgKHRoaXMuaXNSZWFkeSkge1xuICAgICAgdGhpcy5wbGF5ZXIucGF1c2VWaWRlbygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1RoZSBwbGF5ZXIgd2FzIG5vdCByZWFkeSB3aGVuIHRyaWVkIHRvIHBhdXNlLicpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBjdWVWaWRlb0J5SWQodmlkZW9JZDogc3RyaW5nLCBzdGFydFNlY29uZHM/OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XG4gICAgICB0aGlzLnBsYXllci5jdWVWaWRlb0J5SWQodmlkZW9JZCwgc3RhcnRTZWNvbmRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdUaGUgcGxheWVyIHdhcyBub3QgcmVhZHkgd2hlbiB0cmllZCB0byBjdWVWaWRlb0J5SWQuJyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGxvYWRWaWRlb0J5SWQodmlkZW9JZDogc3RyaW5nLCBzdGFydFNlY29uZHM/OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5pc1JlYWR5KSB7XG4gICAgICB0aGlzLnBsYXllci5sb2FkVmlkZW9CeUlkKHZpZGVvSWQsIHN0YXJ0U2Vjb25kcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybignVGhlIHBsYXllciB3YXMgbm90IHJlYWR5IHdoZW4gdHJpZWQgdG8gbG9hZFZpZGVvQnlJZC4nKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9ucGxheSgpIHtcbiAgICB0aGlzLnBsYXlpbmcuZW1pdCgpO1xuICAgIHRoaXMueXRQbGF5ZXJTZXJ2aWNlLnBhdXNlQWxsRXhjZXB0KHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBpbml0UGxheWVyKHZpZGVvSWQ6IHN0cmluZywgcGxheWVyVmFyczogWVQuUGxheWVyVmFycywgZG9tSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IG9uUmVhZHkgPSAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuaXNSZWFkeSkge1xuICAgICAgICB0aGlzLnJlYWR5LmVtaXQoKTtcbiAgICAgICAgdGhpcy5pc1JlYWR5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IG9uU3RhdGVDaGFuZ2UgPSAoeyBkYXRhIH0pID0+IHtcbiAgICAgIHN3aXRjaCAoZGF0YSkge1xuICAgICAgICBjYXNlIFlULlBsYXllclN0YXRlLlVOU1RBUlRFRDpcbiAgICAgICAgICB0aGlzLnVuc3RhcnRlZC5lbWl0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgWVQuUGxheWVyU3RhdGUuRU5ERUQ6XG4gICAgICAgICAgdGhpcy5lbmRlZC5lbWl0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgWVQuUGxheWVyU3RhdGUuUExBWUlORzpcbiAgICAgICAgICB0aGlzLm9ucGxheSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFlULlBsYXllclN0YXRlLlBBVVNFRDpcbiAgICAgICAgICB0aGlzLnBhdXNlZC5lbWl0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgWVQuUGxheWVyU3RhdGUuQlVGRkVSSU5HOlxuICAgICAgICAgIHRoaXMuYnVmZmVyaW5nLmVtaXQoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBZVC5QbGF5ZXJTdGF0ZS5DVUVEOlxuICAgICAgICAgIHRoaXMuY3VlZC5lbWl0KCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgWVQuUGxheWVyKGRvbUlkLCB7XG4gICAgICB2aWRlb0lkLFxuICAgICAgcGxheWVyVmFycyxcbiAgICAgIGV2ZW50czogeyBvblJlYWR5LCBvblN0YXRlQ2hhbmdlIH1cbiAgICB9KTtcbiAgfVxufVxuIl19